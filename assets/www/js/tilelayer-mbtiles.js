// inspired by: https://github.com/coomsie/topomap.co.nz/blob/master/Resources/leaflet/TileLayer.DB.js
L.TileLayer.MBTiles = L.TileLayer.extend({
    //db: SQLitePlugin
    mbTilesDB: null,

    initialize: function(options, db) {
        console.log("I pass here");
        this.mbTilesDB = db;
        L.Util.setOptions(this, options);
    },
    getTileUrl: function (tilePoint,callBack) {

        //var z = 12;
        var x = tilePoint.x;
        var y = tilePoint.y;
        var z = tilePoint.z;
        //var x = 775;
        //var y = 2554;
        var base64Prefix = 'data:image/png;base64,';
        console.log('zoom: ' + z + ' x : ' + x + ' y : ' + y);

        this.mbTilesDB.transaction(function(tx) {

            tx.executeSql("SELECT tile_data FROM images INNER JOIN map ON images.tile_id = map.tile_id WHERE zoom_level = ? AND tile_column = ? AND tile_row = ?", [z, x, y], function (tx,res) {
                if(res.rows.length>0) {
                    var src = base64Prefix + res.rows.item(0).tile_data;
                    callBack(src);
                } else {
                    console.log("response : no data");
                }

            }, function (er) {
                        console.log('error with executeSql', er);
                    });
        });

        //IF we return something here it works, the problem is that the call to getTileUrl is sync, and we need to make it async
        //return "data:image/png;base64,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";
        // return "http://b.tiles.mapbox.com/v3/examples.map-20v6611k/11/387/770.png";

    },

    _loadTile: function (tile, tilePoint) {
        
        tile._layer  = this;
        tile.onload  = this._tileOnLoad;
        tile.onerror = this._tileOnError;

        this._adjustTilePoint(tilePoint);

        this.getTileUrl(tilePoint,function(src) {
            tile.src = src;
        });
    }
});